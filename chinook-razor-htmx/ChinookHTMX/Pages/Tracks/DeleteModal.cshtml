@model ChinookHTMX.Pages.Tracks.DeleteModel

<div id="delete-track-modal" class="modal fade" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Confirm Deletion
                </h5>
                <button type="button" class="btn-close btn-close-white"
                        data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <strong>Warning!</strong> This action cannot be undone.
                </div>

                <p class="mb-3">Are you sure you want to delete this track?</p>

                <!-- Entity Details -->
                <div class="card bg-light border-left-danger">
                    <div class="card-body">
                        <dl class="row mb-0">
                            <dt class="col-sm-3">Track Name:</dt>
                            <dd class="col-sm-9">
                                <strong>@Html.DisplayFor(model => model.Track.Name)</strong>
                            </dd>
                            @if (Model.Track.Album != null)
                            {
                                <dt class="col-sm-3">Album:</dt>
                                <dd class="col-sm-9">
                                    @Html.DisplayFor(model => model.Track.Album.Title)
                                </dd>
                            }
                            @if (Model.Track.Genre != null)
                            {
                                <dt class="col-sm-3">Genre:</dt>
                                <dd class="col-sm-9">
                                    @Html.DisplayFor(model => model.Track.Genre.Name)
                                </dd>
                            }
                            @if (Model.Track.MediaType != null)
                            {
                                <dt class="col-sm-3">Media Type:</dt>
                                <dd class="col-sm-9">
                                    @Html.DisplayFor(model => model.Track.MediaType.Name)
                                </dd>
                            }
                        </dl>
                    </div>
                </div>

                <!-- Results Container -->
                <div id="delete-results" class="mt-3"></div>
            </div>
            <div class="modal-footer">
                <form method="post"
                      hx-post="@Url.Page("Delete", values: new { Model.Track.Id })"
                      hx-target="#delete-results"
                      hx-swap="innerHTML"
                      hx-indicator="#delete-loading"
                      hx-on::after-request="if(event.detail.successful) {
                          setTimeout(() => {
                              bootstrap.Modal.getInstance(document.getElementById('delete-track-modal')).hide();
                              htmx.trigger('body', 'refreshTable');
                          }, 1500);
                      }">

                    <input type="hidden" asp-for="Track.Id"/>
                    @Html.AntiForgeryToken()

                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="btn btn-danger">
                        <span id="delete-loading" class="htmx-indicator">
                            <span class="spinner-border spinner-border-sm me-2"></span>
                        </span>
                        <i class="fas fa-trash"></i> Delete Track
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function showModal() {
        const modal = new bootstrap.Modal('#delete-track-modal');
        modal.show();
    }
    // scopes the modal so we can keep creating them
    showModal();
</script>